services:
  server:
    image: tasksync-server:latest
    environment:
      - DATABASE_URL=sqlite:///data/tasksync.db
      - JWT_SECRET=super-secret
      - DEV_LOGIN_PASSWORD=tasksync
      - RUST_LOG=info
      - PORT=3000
    ports:
      - "3000:3000"
    volumes:
      - /srv/tasksync/data:/data
    restart: unless-stopped

  web:
    image: tasksync-web:latest
    build:
      context: .
      dockerfile: web/Dockerfile
      args:
        VITE_API_URL: ${VITE_API_URL:-}
        VITE_ALLOWED_HOSTS: ${VITE_ALLOWED_HOSTS:-}
    depends_on:
      - server
    ports:
      - "5173:5173"
    restart: unless-stopped

  seed:
    image: tasksync-server:latest
    command: ["seed"]
    environment:
      - DATABASE_URL=sqlite:///data/tasksync.db
      - SEED_ADMIN_PASSWORD=admin
      - SEED_CONTRIB_PASSWORD=contrib
    volumes:
      - /srv/tasksync/data:/data
    restart: "no"
